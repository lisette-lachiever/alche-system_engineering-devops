#!/bin/bash
# Run nginx as nginx user on port 8080

# Stop nginx if already running
pkill nginx || true

# Ensure nginx listens on port 8080 on all IPs
sed -i 's/listen 80 default_server;/listen 8080;/' /etc/nginx/sites-enabled/default
sed -i 's/listen \[::\]:80 default_server;/listen [::]:8080;/' /etc/nginx/sites-enabled/default

# Ensure nginx runs as nginx user
sed -i 's/^user .*/user nginx;/' /etc/nginx/nginx.conf

# Start nginx AS nginx user
su -s /bin/sh -c "nginx" nginx

# REQUIRED: output must contain the word "nginx"
ps auxff | grep nginx | grep -v grep
